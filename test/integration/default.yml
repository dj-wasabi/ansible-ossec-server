---
- hosts: localhost
  pre_tasks:
    - name: "Add mail.example.com to hosts file."
      action: shell echo '127.0.0.1     mail.example.com' >> /etc/hosts
  roles:
  - role: ansible-ossec-server
    ossec_server_config:
      mail_to:
        - me@example.com
      mail_smtp_server: mail.example.com
      mail_from: ossec@example.com
      frequency_check: 72000
      ignore_files:
        - /etc/mtab
        - /etc/mnttab
        - /etc/hosts.deny
      directories:
        - check_all: 'yes'
          dirs: /etc,/usr/bin,/usr/sbin
        - check_all: 'yes'
          dirs: /bin,/sbin
      localfiles:
        - format: 'syslog'
          location: '/var/log/messages'
        - format: 'syslog'
          location: '/var/log/secure'
      globals:
        - '127.0.0.1'
        - '192.168.2.1'
      connection: 'secure'
      log_level: 1
      email_level: 7
      commands:
        - name: 'host-deny'
          executable: 'host-deny.sh'
          expect: 'srcip'
          timeout_allowed: 'yes'
      active_responses:
        - command: 'host-deny'
          location: 'local'
          level: 6
          timeout: 600
      localfiles:
        - format: 'syslog'
          location: '/var/log/messages'
        - format: 'syslog'
          location: '/var/log/secure'

    ossec_agent_configs:
      - type: os
        type_value: linux
        frequency_check: 79200
        ignore_files:
          - /etc/mtab
          - /etc/mnttab
          - /etc/hosts.deny
          - /etc/mail/statistics
          - /etc/svc/volatile
        directories:
          - check_all: yes
            dirs: /etc,/usr/bin,/usr/sbin
          - check_all: yes
            dirs: /bin,/sbin
        localfiles:
          - format: 'syslog'
            location: '/var/log/messages'
          - format: 'syslog'
            location: '/var/log/secure'
          - format: 'syslog'
            location: '/var/log/maillog'
          - format: 'apache'
            location: '/var/log/httpd/error_log'
          - format: 'apache'
            location: '/var/log/httpd/access_log'
          - format: 'apache'
            location: '/var/ossec/logs/active-responses.log'
